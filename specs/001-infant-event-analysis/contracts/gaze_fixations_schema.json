{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Gaze Fixations Master Log Schema",
  "description": "Schema for the master gaze_fixations.csv file generated by preprocessing pipeline",
  "type": "object",
  "properties": {
    "columns": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 16,
      "contains": {
        "enum": [
          "gaze_fixation_id",
          "participant_id",
          "participant_type",
          "age_months",
          "age_group",
          "trial_number",
          "condition",
          "condition_name",
          "segment",
          "aoi_category",
          "gaze_start_frame",
          "gaze_end_frame",
          "gaze_duration_frames",
          "gaze_duration_ms",
          "gaze_onset_time",
          "gaze_offset_time"
        ]
      }
    },
    "rows": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/GazeFixation"
      }
    }
  },
  "required": ["columns", "rows"],
  "definitions": {
    "GazeFixation": {
      "type": "object",
      "properties": {
        "gaze_fixation_id": {
          "type": "integer",
          "minimum": 1,
          "description": "Unique identifier for this gaze fixation"
        },
        "participant_id": {
          "type": "string",
          "minLength": 1,
          "description": "Participant identifier from raw data"
        },
        "participant_type": {
          "type": "string",
          "enum": ["infant", "adult"],
          "description": "Participant age category"
        },
        "age_months": {
          "type": "integer",
          "minimum": 1,
          "description": "Participant age in months"
        },
        "age_group": {
          "type": "string",
          "description": "Categorical age group (e.g., '8-month-olds', '12-month-olds', 'adult')"
        },
        "trial_number": {
          "type": "integer",
          "minimum": 1,
          "description": "Trial number within session"
        },
        "condition": {
          "type": "string",
          "minLength": 1,
          "description": "Experimental condition code (e.g., 'gw', 'hw')"
        },
        "condition_name": {
          "type": "string",
          "minLength": 1,
          "description": "Full condition name (e.g., 'GIVE_WITH', 'HUG_WITH')"
        },
        "segment": {
          "type": "string",
          "minLength": 1,
          "description": "Event segment (e.g., 'approach', 'action', 'post')"
        },
        "aoi_category": {
          "type": "string",
          "enum": [
            "screen_nonAOI",
            "woman_face",
            "man_face",
            "toy_present",
            "toy_location",
            "man_body",
            "woman_body",
            "man_hands",
            "woman_hands"
          ],
          "description": "AOI category derived from What+Where mapping"
        },
        "gaze_start_frame": {
          "type": "integer",
          "minimum": 1,
          "description": "Trial frame number of first frame in gaze fixation"
        },
        "gaze_end_frame": {
          "type": "integer",
          "minimum": 1,
          "description": "Trial frame number of last frame in gaze fixation"
        },
        "gaze_duration_frames": {
          "type": "integer",
          "minimum": 3,
          "description": "Number of frames in this gaze fixation (must be >= 3)"
        },
        "gaze_duration_ms": {
          "type": "number",
          "minimum": 0,
          "exclusiveMinimum": true,
          "description": "Duration of gaze fixation in milliseconds"
        },
        "gaze_onset_time": {
          "type": "number",
          "minimum": 0,
          "description": "Onset time of first frame in seconds"
        },
        "gaze_offset_time": {
          "type": "number",
          "minimum": 0,
          "description": "Offset time of last frame in seconds"
        }
      },
      "required": [
        "gaze_fixation_id",
        "participant_id",
        "participant_type",
        "age_months",
        "age_group",
        "trial_number",
        "condition",
        "condition_name",
        "segment",
        "aoi_category",
        "gaze_start_frame",
        "gaze_end_frame",
        "gaze_duration_frames",
        "gaze_duration_ms",
        "gaze_onset_time",
        "gaze_offset_time"
      ],
      "allOf": [
        {
          "description": "gaze_end_frame must be at least gaze_start_frame + 2 (for minimum 3 frames)",
          "if": {
            "properties": {
              "gaze_start_frame": {"type": "integer"}
            }
          },
          "then": {
            "properties": {
              "gaze_end_frame": {
                "type": "integer",
                "minimum": {"$data": "1/gaze_start_frame"}
              }
            }
          }
        },
        {
          "description": "gaze_offset_time must be greater than gaze_onset_time",
          "if": {
            "properties": {
              "gaze_onset_time": {"type": "number"}
            }
          },
          "then": {
            "properties": {
              "gaze_offset_time": {
                "type": "number",
                "exclusiveMinimum": {"$data": "1/gaze_onset_time"}
              }
            }
          }
        }
      ]
    }
  },
  "metadata": {
    "version": "1.0.0",
    "created": "2025-10-25",
    "purpose": "Validate master gaze fixations CSV file before analysis",
    "validation_level": "structural",
    "halt_on_failure": true,
    "notes": [
      "gaze_duration_frames must equal gaze_end_frame - gaze_start_frame + 1",
      "gaze_duration_ms should approximately equal (gaze_offset_time - gaze_onset_time) * 1000",
      "All gaze fixations must have at least 3 consecutive frames (gaze_duration_frames >= 3)"
    ]
  }
}
