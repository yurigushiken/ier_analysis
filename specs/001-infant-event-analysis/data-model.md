# Data Model: Infant Event Representation Analysis

**Feature**: 001-infant-event-analysis
**Date**: 2025-10-25
**Purpose**: Document all entities, relationships, validation rules, and data transformations

## Overview

This data model describes the structure of all data entities in the infant event representation analysis pipeline, from raw eye-tracking CSV files through the master gaze fixations log to final analysis outputs.

## Entity Definitions

### Entity 1: Raw Frame Record

**Description**: A single frame of eye-tracking data from the raw CSV files

**Source**: CSV files in `data/csvs_human_verified_vv/child/` and `data/csvs_human_verified_vv/adult/`

**Schema**:

| Field Name | Type | Required | Constraints | Description |
|------------|------|----------|-------------|-------------|
| Participant | string | Yes | Non-empty | Unique participant identifier (e.g., "Eight-0101-947") |
| Frame Number | int | Yes | >= 1 | Frame index within session context |
| Time | string | Yes | Format: HH:MM:SS:MS | Human-readable timestamp |
| What | string | Yes | Enum: see AOI Categories | First part of AOI identifier |
| Where | string | Yes | Enum: see AOI Categories | Second part of AOI identifier |
| Onset | float | Yes | >= 0 | Frame onset time in seconds |
| Offset | float | Yes | > Onset | Frame offset time in seconds |
| Blue Dot Center | string | No | Format: "(x, y)" | Gaze coordinate on screen |
| event_verified | string | Yes | Non-empty | Experimental condition code verified (e.g., "gw", "gwo", "sw") |
| frame_count_event | int | Yes | >= 1 | Cumulative frame within current event presentation |
| trial_number | int | Yes | >= 1 | Trial number within session |
| trial_number_global | int | Yes | >= 1 | Repetition count for the same event for a participant |
| frame_count_trial_number | int | Yes | >= 1 | Frame index within current trial |
| segment | string | Yes | Non-empty | Event segment (e.g., "approach", "action") |
| frame_count_segment | int | Yes | >= 1 | Frame index within current segment |
| participant_type | string | Yes | Enum: "infant", "adult" | Participant age category |
| participant_age_months | int | Yes | > 0, < 1200 | Participant age in months |
| participant_age_years | float | Yes | > 0, < 100 | Participant age in years |

**Validation Rules**:
- **Structural (HALT on failure)**:
  - All required columns present (per current dataset schema)
  - Types match specification (str, int, float as appropriate)
  - CSV parseable as UTF-8
  - Required fields non-empty (Participant, What, Where, event_verified, segment, trial_number, participant_age_months)

- **Data Quality (HALT on failure)**:
  - Onset < Offset (temporal consistency required)
  - What+Where must be a valid AOI pair
  - Age in valid range (0 < months < 1200)
  - No invalid or missing required categorical codes (e.g., participant_type)

**Relationships**:
- Each Raw Frame Record belongs to exactly one Participant
- Each Raw Frame Record belongs to exactly one Trial
- Each Raw Frame Record has exactly one AOI Category (derived from What+Where)

---

### Entity 2: AOI Category

**Description**: A defined area of interest combining "What" and "Where" values

**Enumeration**: 9 valid on-screen categories (off-screen excluded from events)

| What | Where | AOI Category Label | Meaning |
|------|-------|-------------------|---------|
| screen | other | screen_nonAOI | On screen but not a specific AOI |
| woman | face | woman_face | Woman's face |
| man | face | man_face | Man's face |
| toy | other | toy_present | Toy object (in "with" trials) |
| toy2 | other | toy_location | Toy location (in "without" trials, no physical toy) |
| man | body | man_body | Man's body |
| woman | body | woman_body | Woman's body |
| man | hands | man_hands | Man's hands |
| woman | hands | woman_hands | Woman's hands |

**Validation Rules**:
- What+Where combination must be one of the 10 valid pairs
- Invalid combinations are flagged as data quality warnings

**Categorization for Analysis**:
- **Faces**: woman_face, man_face
- **Bodies**: woman_body, man_body
- **Hands**: woman_hands, man_hands
- **Objects**: toy_present, toy_location
- **Non-AOI**: screen_nonAOI

**Relationships**:
- Many Raw Frame Records map to one AOI Category
- Social Gaze Triplets reference specific AOI Categories (face→toy→face patterns)

---

### Entity 3: Gaze Fixation

**Description**: A continuous sequence of 3 or more consecutive frames on the same AOI

**Source**: Generated by preprocessing from Raw Frame Records (off-screen frames excluded; durations derived from Onset/Offset times)

**Schema**:

| Field Name | Type | Required | Constraints | Description |
|------------|------|----------|-------------|-------------|
| gaze_fixation_id | int | Yes | Unique, auto-increment | Unique identifier for this gaze fixation |
| participant_id | string | Yes | Non-empty | From Raw Frame Record |
| participant_type | string | Yes | Enum: "infant", "adult" | From Raw Frame Record |
| age_months | int | Yes | > 0 | From participant_age_months |
| age_group | string | Yes | Computed | Age category (e.g., "8-month", "12-month") |
| trial_number | int | Yes | >= 1 | From trial_block_cumulative_order |
| condition | string | Yes | Non-empty | Experimental condition code |
| condition_name | string | Yes | Computed | Full condition name (e.g., "GIVE_WITH") |
| segment | string | Yes | Non-empty | Event segment (approach, action, post) |
| aoi_category | string | Yes | Valid AOI | AOI label from AOI Category mapping |
| gaze_start_frame | int | Yes | >= 1 | Frame index within trial at first frame in sequence (`frame_count_trial_number`) |
| gaze_end_frame | int | Yes | >= gaze_start_frame + 2 | Frame index within trial at last frame in sequence (`frame_count_trial_number`) |
| gaze_duration_frames | int | Yes | >= 3 | Number of frames (end - start + 1) |
| gaze_duration_ms | float | Yes | > 0 | Duration in milliseconds (computed from Onset/Offset) |
| gaze_onset_time | float | Yes | >= 0 | Onset time of first frame in seconds |
| gaze_offset_time | float | Yes | > gaze_onset_time | Offset time of last frame in seconds |

**Validation Rules**:
- gaze_duration_frames must be >= 3 (definition of gaze fixation)
- gaze_end_frame >= gaze_start_frame + 2
- gaze_duration_ms = (gaze_offset_time - gaze_onset_time) * 1000
- aoi_category must be a valid AOI Category
- All required fields non-null

**Derivation Logic**:
```python
# Pseudocode for gaze fixation detection
for each participant:
    for each trial:
        current_aoi = None
        frame_sequence = []

        for frame in sorted_frames:
            aoi = map_what_where_to_aoi(frame.What, frame.Where)

            if aoi == current_aoi:
                frame_sequence.append(frame)
            else:
                # AOI changed - check if previous sequence qualifies
                if len(frame_sequence) >= 3:
                    create_gaze_fixation(frame_sequence)

                # Start new sequence
                current_aoi = aoi
                frame_sequence = [frame]

        # Handle final sequence
        if len(frame_sequence) >= 3:
            create_gaze_fixation(frame_sequence)
```

**Relationships**:
- Each Gaze Fixation is composed of 3+ Raw Frame Records (consecutive, same AOI)
- Each Gaze Fixation belongs to exactly one Participant
- Each Gaze Fixation belongs to exactly one Trial
- Multiple Gaze Fixations form Transitions
- Sequences of Gaze Fixations may form Social Gaze Triplets

---

### Entity 4: Participant

**Description**: An infant or adult subject in the study

**Source**: Derived from Raw Frame Records (participant_id, participant_type, participant_age_months)

**Schema**:

| Field Name | Type | Required | Constraints | Description |
|------------|------|----------|-------------|-------------|
| participant_id | string | Yes | Unique | Identifier (e.g., "Eight-0101-947") |
| participant_type | string | Yes | Enum: "infant", "adult" | Age category |
| age_months | int | Yes | > 0 | Age in months |
| age_years | float | Yes | > 0 | Age in years |
| age_group | string | Yes | Computed | Categorical age (e.g., "8-month-olds") |
| num_trials | int | Yes | >= 0 | Count of trials with valid data |
| num_gaze_fixations | int | Yes | >= 0 | Count of gaze fixations for this participant |
| data_quality_flags | list[string] | No | - | Any quality warnings for this participant |

**Age Group Mapping**:
- Infants: age_months determines group (e.g., 8, 12, 16, 20 months)
- Adults: "adult" category

**Validation Rules**:
- participant_id must be unique across all raw CSVs
- age_months and age_years must be consistent (age_years ≈ age_months / 12)

**Relationships**:
- One Participant has many Raw Frame Records
- One Participant has many Gaze Fixations
- One Participant participates in many Trials

---

### Entity 5: Trial

**Description**: A single experimental viewing instance

**Source**: Derived from Raw Frame Records (trial_number, event_verified, segment)

**Schema**:

| Field Name | Type | Required | Constraints | Description |
|------------|------|----------|-------------|-------------|
| trial_id | string | Yes | Unique | participant_id + trial_number |
| participant_id | string | Yes | FK to Participant | Which participant |
| trial_number | int | Yes | >= 1 | Sequential trial number (from raw column `trial_number`) |
| condition | string | Yes | Non-empty | Experimental condition code from `event_verified` (e.g., "gw") |
| condition_name | string | Yes | Computed | Full name (e.g., "GIVE_WITH") |
| num_frames | int | Yes | > 0 | Total frames in this trial |
| num_gaze_fixations | int | Yes | >= 0 | Count of gaze fixations in this trial |
| total_gaze_duration_ms | float | Yes | >= 0 | Sum of all gaze fixation durations |
| proportion_offscreen | float | Yes | 0.0 - 1.0 | Proportion of frames with off_screen AOI (quality metric; excluded from events/denominators) |
| data_quality_flag | string | No | - | "outlier" if proportion_offscreen > 0.5 |

**Condition Code Mapping** (examples, actual codes from data):
- "gw" → "GIVE_WITH" (give with toy present)
- "hw" → "HUG_WITH" (hug with toy present)
- "sw" → "SHOW_WITH" (show with toy present)
- (Similar patterns for "without" variants if present)

**Validation Rules**:
- trial_id = participant_id + "_" + str(trial_number) must be unique
- num_gaze_fixations <= num_frames / 3 (can't have more gazes than possible)
- Flag as outlier if proportion_offscreen > 0.5 (per edge case handling)

**Relationships**:
- Each Trial belongs to exactly one Participant
- One Trial has many Raw Frame Records
- One Trial has many Gaze Fixations
- One Trial belongs to exactly one Experimental Condition

---

### Entity 6: Experimental Condition

**Description**: The type of social event shown to the infant

**Enumeration**: Determined from raw data event codes

**Schema**:

| Field Name | Type | Required | Description |
|------------|------|----------|-------------|
| condition_code | string | Yes | Short code from raw data (e.g., "gw") |
| condition_name | string | Yes | Full name (e.g., "GIVE_WITH") |
| event_type | string | Yes | Base event: GIVE, HUG, SHOW |
| toy_variant | string | Yes | "with" or "without" toy present |
| toy_relevance | string | Yes | "relevant" or "irrelevant" or "N/A" |
| description | string | No | Human-readable description |

**Known Conditions** (from spec):
- GIVE: Object transfer event - toy is relevant
- HUG: Affectionate gesture - toy is irrelevant (present but not central)
- SHOW: Object display event - toy is relevant

**Validation Rules**:
- Must have at least GIVE and HUG conditions (per assumptions)
- SHOW condition is optional (AR-7 skipped if not present)

**Relationships**:
- One Experimental Condition applies to many Trials
- Conditions are compared in statistical analyses

---

### Entity 7: Transition

**Description**: A change from one gaze fixation to another (different AOI)

**Source**: Computed from consecutive Gaze Fixations within a trial

**Schema**:

| Field Name | Type | Required | Constraints | Description |
|------------|------|----------|-------------|-------------|
| transition_id | int | Yes | Unique | Auto-increment identifier |
| participant_id | string | Yes | FK to Participant | From gaze fixations |
| trial_number | int | Yes | >= 1 | From gaze fixations |
| condition | string | Yes | - | Experimental condition |
| from_aoi | string | Yes | Valid AOI | Source AOI of transition |
| to_aoi | string | Yes | Valid AOI | Target AOI of transition |
| transition_time | float | Yes | >= 0 | Time of transition (gaze_offset_time of source gaze) |
| source_gaze_id | int | Yes | FK to Gaze Fixation | Gaze fixation being transitioned from |
| target_gaze_id | int | Yes | FK to Gaze Fixation | Gaze fixation being transitioned to |

**Derivation Logic**:
```python
# Pseudocode for transition detection
for each trial:
    gazes = get_sorted_gaze_fixations(trial)

    for i in range(len(gazes) - 1):
        source_gaze = gazes[i]
        target_gaze = gazes[i+1]

        if source_gaze.aoi_category != target_gaze.aoi_category:
            create_transition(
                from_aoi=source_gaze.aoi_category,
                to_aoi=target_gaze.aoi_category,
                time=source_gaze.gaze_offset_time
            )
```

**Validation Rules**:
- from_aoi != to_aoi (transition requires AOI change)
- target_gaze_id.gaze_start_frame > source_gaze_id.gaze_end_frame (temporal order)
- Both source and target gazes belong to same trial

**Relationships**:
- Each Transition connects two Gaze Fixations
- Many Transitions used to compute Transition Probability Matrices (AR-2)

---

### Entity 8: Social Gaze Triplet

**Description**: A specific sequence pattern of three consecutive gazes indicating joint attention

**Source**: Detected from sequences of Gaze Fixations

**Valid Patterns** (per clarifications):
1. man_face → toy_present → woman_face
2. woman_face → toy_present → man_face

**Invalid Patterns** (excluded):
- man_face → toy_present → man_face (same person)
- woman_face → toy_present → woman_face (same person)

**Schema**:

| Field Name | Type | Required | Constraints | Description |
|------------|------|----------|-------------|-------------|
| triplet_id | int | Yes | Unique | Auto-increment identifier |
| participant_id | string | Yes | FK to Participant | From gaze fixations |
| trial_number | int | Yes | >= 1 | From gaze fixations |
| condition | string | Yes | - | Experimental condition |
| pattern_type | string | Yes | "man_toy_woman" or "woman_toy_man" | Which valid pattern |
| gaze1_id | int | Yes | FK to Gaze Fixation | First gaze (face) |
| gaze2_id | int | Yes | FK to Gaze Fixation | Second gaze (toy) |
| gaze3_id | int | Yes | FK to Gaze Fixation | Third gaze (face) |
| triplet_start_frame | int | Yes | - | gaze1.gaze_start_frame |
| triplet_end_frame | int | Yes | - | gaze3.gaze_end_frame |
| triplet_duration_ms | float | Yes | > 0 | Total time span of triplet |

**Derivation Logic**:
```python
# Pseudocode for social gaze triplet detection
for each trial:
    gazes = get_sorted_gaze_fixations(trial)

    for i in range(len(gazes) - 2):
        gaze1 = gazes[i]
        gaze2 = gazes[i+1]
        gaze3 = gazes[i+2]

        # Check man→toy→woman pattern
        if (gaze1.aoi_category == "man_face" and
            gaze2.aoi_category == "toy_present" and
            gaze3.aoi_category == "woman_face"):
            create_triplet(pattern="man_toy_woman", gazes=[gaze1, gaze2, gaze3])

        # Check woman→toy→man pattern
        elif (gaze1.aoi_category == "woman_face" and
              gaze2.aoi_category == "toy_present" and
              gaze3.aoi_category == "man_face"):
            create_triplet(pattern="woman_toy_man", gazes=[gaze1, gaze2, gaze3])
```

**Validation Rules**:
- All three gazes must be consecutive in temporal order
- All three gazes must belong to same trial
- Pattern must be one of two valid types
- Middle gaze must be toy_present (not toy_location - requires actual toy)

**Relationships**:
- Each Social Gaze Triplet is composed of exactly 3 Gaze Fixations
- Many Social Gaze Triplets are counted per Participant/Condition for AR-3

---

### Entity 9: Analysis Report

**Description**: A self-contained output document for one analytical requirement

**Source**: Generated by analysis modules

**Schema**:

| Field Name | Type | Required | Description |
|------------|------|----------|-------------|
| report_id | string | Yes | AR identifier (AR-1 through AR-7) |
| analysis_type | string | Yes | Human-readable name (e.g., "Gaze Duration Analysis") |
| generation_timestamp | datetime | Yes | When report was generated |
| html_path | string | Yes | Path to HTML report file |
| pdf_path | string | Yes | Path to PDF report file |
| figures | list[string] | No | Paths to generated visualizations |
| tables | list[string] | No | Paths to CSV summary tables |
| statistical_results | dict | Yes | Key statistical outcomes |

**Standard Report Sections**:
1. **Title & Metadata**: Analysis name, date, parameters
2. **Methods**: Description of analysis procedure, statistical tests used
3. **Results**: Summary statistics tables, p-values, effect sizes
4. **Visualizations**: Bar charts, line plots, directed graphs
5. **Interpretation**: Narrative explanation of findings

**Validation Rules**:
- html_path and pdf_path must exist and be readable
- statistical_results must include p-values for hypothesis tests
- All visualizations must be 300 DPI PNG files
- Reports must be self-contained (embedded images, no external dependencies)

**Relationships**:
- Each Analysis Report processes many Gaze Fixations
- Multiple Analysis Reports are compiled into one Final Compiled Report

---

### Entity 10: Final Compiled Report

**Description**: An integrated document combining all individual analysis reports

**Source**: Generated by report compiler from individual Analysis Reports

**Schema**:

| Field Name | Type | Required | Description |
|------------|------|----------|-------------|
| generation_timestamp | datetime | Yes | When final report was compiled |
| html_path | string | Yes | Path to final HTML report |
| pdf_path | string | Yes | Path to final PDF report |
| included_analyses | list[string] | Yes | AR IDs included (AR-1 through AR-7 or subset) |
| table_of_contents | dict | Yes | Section titles and anchor links |
| summary_statistics | dict | Yes | Overall cross-analysis summaries |

**Report Structure**:
1. **Title Page**: Project title, date, authors
2. **Table of Contents**: Hyperlinked section list
3. **Introduction**: Gordon (2003) background, research questions
4. **Methods Overview**: Gaze fixation definition, participant demographics, data collection
5. **AR-1 Results**: Imported from AR-1 report
6. **AR-2 Results**: Imported from AR-2 report
7. (Continue for all ARs)
8. **General Discussion**: Synthesis across analyses
9. **Appendices**: Data quality reports, exclusion logs

**Validation Rules**:
- At minimum, AR-1 and AR-2 must be included
- Table of contents must have working hyperlinks
- All section cross-references must resolve

**Relationships**:
- One Final Compiled Report includes many Analysis Reports

## Data Flow Diagram

```
Verified CSV Files (data/csvs_human_verified_vv/)
    ↓
[CSV Loader + Validator]
    ↓
Raw Frame Records (in-memory DataFrame)
    ↓
[AOI Mapper]
    ↓
Frame Records with AOI Categories
    ↓
[Gaze Fixation Detector]
    ↓
Gaze Fixations → gaze_fixations.csv (data/processed/)
    ↓
    ├─→ [AR-1: Gaze Duration] → AR-1 Report
    ├─→ [AR-2: Transitions] → AR-2 Report (via Transition derivation)
    ├─→ [AR-3: Social Triplets] → AR-3 Report (via Triplet detection)
    ├─→ [AR-4: Dwell Times] → AR-4 Report
    ├─→ [AR-5: Development] → AR-5 Report
    ├─→ [AR-6: Learning] → AR-6 Report
    └─→ [AR-7: Dissociation] → AR-7 Report
         ↓
    [Report Compiler]
         ↓
    Final Compiled Report (reports/)
```

## State Transitions

### Gaze Fixation Lifecycle

```
1. [Non-existent] → (frame sequence starts) → [Accumulating Frames]
2. [Accumulating Frames] → (frame count >= 3) → [Valid Gaze Fixation]
3. [Accumulating Frames] → (AOI changes, count < 3) → [Discarded]
4. [Valid Gaze Fixation] → (AOI changes) → [Completed Gaze Fixation]
5. [Completed Gaze Fixation] → (written to gaze_fixations.csv) → [Persisted]
```

### Analysis Report Lifecycle

```
1. [Not Generated] → (analysis executes) → [Generating]
2. [Generating] → (success) → [Complete]
3. [Generating] → (failure) → [Error]
4. [Complete] → (compilation) → [Compiled]
```

## Data Integrity Constraints

### Referential Integrity
- Every Gaze Fixation references a valid Participant (participant_id exists)
- Every Gaze Fixation references a valid Trial (trial_number exists for that participant)
- Every Transition references two valid Gaze Fixations (source_gaze_id, target_gaze_id exist)
- Every Social Gaze Triplet references three valid Gaze Fixations (gaze1_id, gaze2_id, gaze3_id exist)

### Temporal Integrity
- Within a trial, frame numbers are monotonically increasing
- Within a trial, time values (Onset, Offset) are monotonically increasing
- Gaze fixations do not overlap in time within a trial
- Transitions occur at gaze boundaries (offset of source = onset of target or immediate next frame)

### Logical Integrity
- Gaze fixation duration (frames) = end_frame - start_frame + 1
- Gaze fixation duration (ms) ≈ (offset_time - onset_time) * 1000 (within rounding tolerance)
- Proportion of looking time per trial sums to 1.0 (across all AOIs)
- Social gaze triplets only formed from consecutive, non-overlapping gazes

### Statistical Integrity
- Minimum sample size n >= 3 for any statistical test
- All p-values are in range [0, 1]
- Effect sizes are computed appropriately for test type
- Degrees of freedom match sample sizes

## Data Validation Summary

| Entity | Structural Checks (HALT) | Data Quality Checks (HALT) |
|--------|---------------------------|----------------------------|
| Raw Frame | Required columns present, types correct | Invalid/missing required values, invalid AOI pairs |
| AOI Category | Valid What+Where pair | Invalid combination |
| Gaze Fixation | Duration >= 3 frames, times consistent | Inconsistent timing/derivations |
| Participant | Unique ID, age fields consistent | Invalid age ranges |
| Trial | Valid participant, condition code | - |
| Transition | From ≠ To, temporal order | - |
| Social Triplet | Valid pattern, consecutive gazes | - |
| Report | Files exist, readable | Missing required results fields |

## Derived Metrics

### Per Participant
- Total number of trials
- Total number of gaze fixations
- Mean gaze duration
- Proportion of gazes per AOI
- Social gaze triplet frequency
- Data quality score (proportion of valid trials)

### Per Trial
- Total looking time (sum of gaze durations)
- Proportion of looking time per AOI
- Number of transitions
- Number of social gaze triplets
- Proportion off-screen (data quality indicator)

### Per Condition
- Mean gaze duration on toy AOI
- Transition probability matrix (10x10 for all AOI pairs)
- Mean social gaze triplet frequency
- Mean dwell times per AOI

### Across Age Groups
- Age × Condition interaction effects
- Developmental trajectories (trend across age groups)

## Assumptions and Defaults

### Temporal Assumptions
- Frame rate is consistent within a session (or differences are negligible)
- Frame timestamps (Onset/Offset) are accurate to millisecond precision
- No missing frames within a trial (consecutive frame numbers)

### Categorical Assumptions
- Experimental conditions are consistent across participants
- AOI labels are consistent across all raw CSV files
- Age groups are predefined and consistent

### Statistical Assumptions
- Alpha level = 0.05 for all hypothesis tests
- Error bars represent Standard Error of Mean (SEM) unless specified
- Effect sizes reported: Cohen's d for t-tests, eta-squared for ANOVA
- Normal distribution for parametric tests (tested before application)

### Missing Data Handling (per clarifications)
- Missing trials: Exclude participant from affected analyses only
- Missing values in non-required fields: Treat as valid missing data
- Insufficient gaze length (<3 frames): Exclude from gaze fixation log
- Insufficient statistical power (n < 3): Skip test, log warning

## Schema Versioning

**Current Version**: 1.0.0

**Change Log**:
- 2025-10-25 (v1.0.0): Initial schema definition based on spec and clarifications

**Backward Compatibility**: N/A (initial version)

**Migration Path**: If raw data schema changes, create migration scripts to:
1. Validate old data
2. Transform to new schema
3. Re-run preprocessing pipeline
4. Document changes in migration log

---

**Document Status**: Complete and ready for contract generation (JSON schemas)
